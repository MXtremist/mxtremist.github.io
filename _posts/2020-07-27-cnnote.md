---
layout:  post
title:  计网复习笔记整理
date:  2020-07-27
Author:  MXtremist
categories: 
tags:  [notes, study]

comments:  true
--- 

按复习顺序（目前的顺序是：绪论→链路层→网络层→传输层→网络安全→多媒体和部分应用层）整理计网复习知识点。🐛🐛🐛



## 绪论

### 什么是因特网

“网络的网络”

从多维度分析：

| 维度 | 解释                      |
| ---- | ------------------------- |
| 设备 | 端设备、通信链路、路由器  |
| 服务 | 分布式应用程序&套接字接口 |
| 协议 | TCP/IP...                 |



### 连接到因特网，然后传输

端系统-边缘路由器-核心路由器-边缘路由器-端系统

| 类型     | 举例                                           |
| -------- | ---------------------------------------------- |
| 网络边缘 | 端系统（主机）：client, server, data center... |
| 网络接入 | 电缆、光纤、卫星...                            |
| 网络核心 | 分组交换机&路由器构成的网络                    |

传输方式：电路交换（独占，e.g.专用电话线）；分组交换（分块传输，核心路由器负责调度）；虚电路（分组交换方式实现电路交换，固定的路由为其预留带宽）



### 协议体系结构

分层的

OSI:物理、数据链路、网络、传输、会话、表示、应用，后三层在TCP/IP中均在应用层实现



### 网络性能评估

| 时延类型 | 产生方式                                                  |
| -------- | --------------------------------------------------------- |
| 传输时延 | 将分组发送出去所需要的时间，Length / Rate                 |
| 传播时延 | 分组在网络中传播所需要的时间，RTT = 2 * propagation delay |
| 排队时延 | 分组在缓冲区等待                                          |
| 处理时延 | 检错、查看首部并导向正确位置                              |

顺序：*4-3-1-2*

**丢包原因**：缓冲区不足 or 传播中出错

**吞吐量**：可用带宽，路径上获得的带宽的最小值



## 链路层

### 核心功能

分帧（frame = 头+datagram+尾）、MAC（媒介访问控制，在共享广播信道时协调节点）



### 差错检测

奇偶校验、CRC（循环冗余检测）

**二维奇偶校验的定位**：横轴、纵轴各有一个出错→交叉定位→纠正；对于两个出错可以检测

**CRC**：传输d比特的数据D，考虑r比特的CRC比特R，$D*2^r{\oplus}R$ 记为<D, R>（形式上为D和R比特的组合）。提前选取r+1位的生成多项式G，然后发送方计算出R，满足<D, R> mod G = 0，发送<D, R>。接收方用G检验发送方数据。

在CRC计算的加减法中使用模2运算（加法不进位减法不借位）。计算R时在D后补r个0，除以G，得到的余数为R

$e.g. D=101110,r=3,G=1001,R=?$

<img src="https://i.loli.net/2020/07/28/9kc57afMuRXEwW3.png"/>

### 局域网 LAN

#### 拓扑结构

星形、环形（token ring：sender发送数据并最终吸收数据，吸收完后释放令牌）、树形...

以太网的总线拓扑：使用同轴电缆总线互联节点（广播局域网）

#### 传输媒介

网线、WiFi

#### 以太网 Ethernet

**服务：**

对网络层提供不可靠服务：若未通过CRC检测则直接丢弃，通过则啥也不做（不发送ACK,Non ACK)

无连接服务（类似UDP，不握手）

**以太网帧的格式**

| 前导码       | Dst Addr | Src Addr | Type          | Data                  | CRC    |
| ------------ | -------- | -------- | ------------- | --------------------- | ------ |
| 标记帧的开始 | 目的地址 | 源地址   | 类型（如arp） | 数据，即IP数据报      | 校验码 |
| 8字节        | 6字节    | 6字节    | 2字节         | 46-1500字节，不足补全 | 4字节  |

地址称为MAC地址，固定值，AB-CD-EF-GH-IJ-LM，前3字节为厂商；可重复

前导码前7个字节均为10101010，最后一个是10101011，为避免Data等中出现前导码，可以用一定规则插入字节，例如每遇到101010则插入0，这样只会在前导码中出现1010101

#### 网桥和交换机

将多个以太网连接成更大的以太网的**局域网组网设备**

**功能**：路由转发和过滤（转发表+地址学习）、生成树算法

**转发表**初始为空，收到A->B，由端口a到达，则记录A对应端口a

**生成树算法**：分布式算法

*广播风暴问题：由于成环导致的，因此使用生成树避免成环

1. 一定规则确定树根，如MAC地址最小值
2. 每个节点向邻居发送Message(Y, d, X)，其中Y为自己目前认为的根，d为自己到根的距离，X为自己，初始时均发送M(X, 0, X)
3. 当节点X收到M(Y, d, Z)，且Y更适合当根（按照1，即Y < X），则更新，X发送M(Y, d+1, X)给邻居

<img src="https://i.loli.net/2020/07/28/CNG9zcbseOMRhFQ.png"/>

**对比：Hub, Bridge, Layer2 switch, Layer3 switch**

| Hub           | 只提供物理转发                                     |
| ------------- | -------------------------------------------------- |
| Bridge        | 有转发表，可自学习                                 |
| Layer2 switch | 增加了交换功能，避免冲突（一个端口就是一个冲突域） |
| Layer3 switch | 加入一些路由器功能                                 |

**共享媒介（Hub、网桥）和交换机的区别：*

1. 能力区别，switch交换逻辑下速度更高且collision free（类似＃一样的连接）
2. 端口数区别，网桥2-4个，交换机很多



### 媒介访问控制 MAC

三大方式：信道切分、轮流访问、随机访问

媒介利用率U = 传输帧的时间/总时间=效率

相对传播时间a=传播时间/传输时间=传播时间（传输时间被正则化为1）

**基础效率分析：**point-to-point方式，总时间为1（传输）+a（传播），传输帧的时间为1，则 $U=\frac{1}{1+a} $

#### 信道切分

1. 时分多址 TDMA：每个时间帧分为固定个时隙，每个节点只能在每个帧中给定的时隙使用；在人少时效率低
2. 频分多址 FDMA：每个节点占用R bps信道的一定频段，故仅有R/N带宽
3. 码分多址 CDMA：每个需要发送的比特拥有1时隙，比特为1或-1；对每个发送方进行特殊编码，将其每个比特编码为M个比特序列，同时发送的发送方的比特序列将作异或，接收方按一定规则解码即可。例如，发送方的编码为1 1 1 -1 1 -1 -1 -1，则1即为上述编码，-1转为-1 -1 -1 1 -1 1 1 1

#### 轮流访问

1. 轮询：选定主节点轮流告诉其余节点可传输帧的数量，鲁棒性低（主节点不可故障）、有轮询时延。e.g.蓝牙

2. 令牌传递协议（令牌环）：拥有令牌的sender发送数据，指明receiver，然后数据在环上运输，某节点发现自己是receiver则接收数据；当sender再次收到该数据时，回收并释放令牌给下一节点

   **效率分析**：假设有N个站点，令牌环下的传播时间a即为绕一圈的时间，总时间为传输帧的时间+将令牌送往下一节点的时间（这时候视为发送完成）。设0时刻开始发送。

   什么时候可以释放令牌：①已发送完毕，即要在1时刻之后；②已回收数据，即要在a时刻之后。

   故对于大帧（a<1)，在1时刻开始释放令牌，对于小帧（a>1），在a时刻开始释放令牌，释放令牌需要的时间为a/N；

   故大帧效率：$U=\frac{1}{1+\frac{a}{N}} $，小帧效率：$U=\frac{1}{a+\frac{a}{N}} $。

#### 随机访问

##### ALOHA

立刻传输，若传输过程中发生碰撞，在传输完后立刻以p概率重传，否则等待一个帧的时间，再以p概率重传。

**效率分析**：设一个帧时间为1，某节点的某帧在t~0~时间开始传输（概率为p），则若成功，[t~0~-1, t~0~]以及[t~0~, t~0~+1]时间内均不能有其他帧的传输，概率为 $p(1-p)^{(N-1)}$，故总的成功概率为 $p(1-p)^{2(N-1)}$，效率为 $Np(1-p)^{2(N-1)}$。当N趋于无穷时，求极限得其最大效率为p = 1 / (2N - 1)时，效率 $U=\frac{1}{2e} $.

##### 时隙ALOHA

帧：L比特，一个时隙：L/R，在每个时隙的起点以ALOHA的方式发送（即若碰撞则等待一个时隙，再以p概率）

**效率分析**：t~0~时刻其他不发送即可，即 $Np(1-p)^{N-1}$。当p = 1/N时，最大效率 $U=\frac{1}{e} $.

##### 载波侦听多路访问 CSMA

先听信道是否繁忙，若不繁忙则传输，否则：

非持续：等待随机一段时间

1-持续：一直等待直到空闲，然后抢占

p-持续：一直等待直到空闲，然后按p概率抢占，一般p=1/N

CSMA/CD：**以太网的方法**，引入碰撞检测，在传输过程中若发生碰撞则立即停止，然后发送jam信号（全1）提醒其他节点（用以保证其余所有节点都检测到该次冲突）。在这之后，使用二进制指数后退算法（BEB），即在碰撞n次后，从[0, 2^n^-1]大小的窗口中选择一个随机数K，等待K个时隙。在0-10次，窗口放大，11-16次，窗口不变，仍失败则丢包。

**时隙被定义为512bit在10Mbps或100Mbps网络的发送时间*

CSMA与ALOHA相比，多了“听”的过程，即若繁忙会等待到不繁忙。

**效率分析**：

假设是p-持续的，而不是BEB算法

某个节点在某个slot成功发送的概率为 $A=Np(1-p)^{N-1}$

取极限，可得 $p=\frac{1}{N}$ 时， $A=(1-\frac{1}{N})^{N-1}$，当N趋于无穷时 $A=1/e$

某个节点用j个slots发送出去的概率为 $A(1-A)^j$

假设一个contention slot为2a（最坏情况下需要两倍传播时间检测到冲突），在每一个contention slot，所有节点都以概率p抢占信道，直到某个节点抢到并成功发送数据。

平均情况下，需要 $\sum_{j}^{\infty}jA(1-A)^j$ 个slots（几何分布），该值为$B=\frac{1-A}{A}$。

故

$U=\frac{Frame\ time}{Frame\ time+Propagation\ time+Average\ contention time}$

​	$=\frac{1}{1+a+2aB}$

​	$=\frac{1}{1+\frac{2-A}Aa}\approx \frac{1}{1+4.44a}$

对于实际的CSMA/CD，其近似值为：





### 无线局域网 WLAN



## 网络层



## 传输层



## 网络安全



## 多媒体和部分应用层



最后修改于 2020-7-29